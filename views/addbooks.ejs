<!DOCTYPE html>
<html>
<head>
    <title>SocialLibrary | Sell</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/sheet.css">
    <link href='https://fonts.googleapis.com/css?family=Sofia' rel='stylesheet'>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="css/style.css" rel="stylesheet">

</head>
<body>
    <% include partials/header %>
    <div class="container">
        <% if (locals.user) { %>
            <form id="addListForm" class="text border border-light p-5" method="post" action="/addbooks">

                <p class="h2 mb-4">Add New book Sell Listing</p>

                <!-- ISBN -->
                <p>ISBN</p>
                <input list="ISBN" id="addListISBN" class="form-control mb-4" name="ISBN" required oninput="getList()" onchange="getIsbn()">
                <datalist id="ISBN">
                    <option>abc</option>
                </datalist>

                <!-- Name -->
                <p>Book Title</p>
                <input type="text" id="addListTitle" class="form-control mb-4" name="title" required>

                <!-- Genre -->
                <p>Genre</p>
                <input type="text" id="addListGenre" class="form-control mb-4" name="genre" required>
                
                <!-- Language -->
                <p>Language</p>
                <input type="text" id="addListLanguage" class="form-control mb-4" name="language" required>
                
                <!-- Author Name -->
                <p>Author Name</p>
                <input type="text" id="addListAuthor" class="form-control mb-4" name="author" required>
                
                <!-- Publisher Name -->
                <p>Publisher Name</p>
                <input type="text" id="addListPublisher" class="form-control mb-4" name="publisher" required>
                
                <!-- Price -->
                <p>Price</p>
                <input type="number" id="addListPrice" class="form-control mb-4" name="price" min='0' required>
                
                <!-- Sell/Lend -->
                <input type="radio" id="addListSellLend" class="" name="status" value="lend" required>Lend<br>
                <input type="radio" id="addListSellLend" class="" name="status" value="sell" required>Sell
                
                <!-- URL -->
                <p>Image URL</p>
                <input type="text" id="addListURL" class="form-control mb-4" name="URL" required>
                
                <!-- Submit button -->
                <button class="btn btn-info my-4 btn-block" type="submit">Create Listing</button>
                <hr>
        <% } else { %>
            <p>
                You are not a valid user. Please <a href="/signup">Sign Up</a>
            </p>
            <p>Have an Account?
                <a href="/signin">Sign In</a>
            </p>
        <% } %>
    </div>
    <% include partials/footer %>
    <script>
        function getList() {
            document.getElementById("addListTitle").value='';
            document.getElementById("addListGenre").value='';
            document.getElementById("addListLanguage").value='';
            document.getElementById("addListAuthor").value='';
            document.getElementById("addListPublisher").value='';
            document.getElementById("addListTitle").readOnly = false;
            document.getElementById("addListGenre").readOnly = false;
            document.getElementById("addListLanguage").readOnly = false;
            document.getElementById("addListAuthor").readOnly = false;
            document.getElementById("addListPublisher").readOnly = false;
            var isbnval = document.getElementById("addListISBN").value;
            var xmlhttp = new XMLHttpRequest();
            var url = 'lookupISBN';
            var params = 'isbn='+isbnval;
            xmlhttp.open('POST', url, true);
		    xmlhttp.onreadystatechange = function() {
			    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    createList(xmlhttp);
                }
			}
            xmlhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
            xmlhttp.send(params);

            function createList(xmlhttp){
                var dataisbn = JSON.parse(xmlhttp.responseText);
                var list = "";
                var i;
                for(i = 0;i < dataisbn.length;i++) {
                    list += '<option>' + dataisbn[i].ISBN + '</option>';
                }
                document.getElementById("ISBN").innerHTML=list;
            }
        }
        function getIsbn() {
            var isbnval = document.getElementById("addListISBN").value;
            var xmlhttp = new XMLHttpRequest();
            var url = 'lookupdata';
            var params = 'isbn='+isbnval;
            xmlhttp.open('POST', url, true);
		    xmlhttp.onreadystatechange = function() {
			    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    createList(xmlhttp);
                }
			}
            xmlhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
            xmlhttp.send(params);

            function createList(xmlhttp){
                var dataisbn = JSON.parse(xmlhttp.responseText);
                if(dataisbn.length>0){
                    document.getElementById("addListTitle").value=dataisbn[0].title;
                    document.getElementById("addListGenre").value=dataisbn[0].genre;
                    document.getElementById("addListLanguage").value=dataisbn[0].language;
                    document.getElementById("addListAuthor").value=dataisbn[0].author.name;
                    document.getElementById("addListPublisher").value=dataisbn[0].publisher.name;
                    document.getElementById("addListTitle").readOnly = true;
                    document.getElementById("addListGenre").readOnly = true;
                    document.getElementById("addListLanguage").readOnly = true;
                    document.getElementById("addListAuthor").readOnly = true;
                    document.getElementById("addListPublisher").readOnly = true;
                }    
            }
        }
    </script>
</body>
</html>